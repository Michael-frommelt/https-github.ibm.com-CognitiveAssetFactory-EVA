/**
  * Copyright 2018 IBM Deutschland. All Rights Reserved.
  *
  * Enhanced conVersation Asset - EVA
  * Repository: https://github.ibm.com/CognitiveAssetFactory/EVA
  *
  * External chat frontend.
  * Provides an easy to include chat frontend written in plain javascript.
  *
  * @preserve
  * @author Sebastian Kowalski (sebastian.kowalski@de.ibm.com)
  */

var evaFrontendConfig={routes:{resetSessionRoute:"/api/public/session/reset",sendUserMessageRoute:"/api/public/message",keepAliveRoute:"/api/public/session/keepalive",saveConversationFeedback:"/api/public/conversation-feedback"},loggingEnabled:!1,shortConcatTimeout:1500,longConcatTimeout:3500,waitingTimePerChar:30,minWaitingTime:750,paths:{icon:"./EVA0.png"},chatBubble:{appearenceTime:15e3,firstAppearAfter:5e3,shakeAtFirstAppear:!0,secondAppearAfter:5e4,shakeAtSecondAppear:!1,thirdAppearAfter:125e3,shakeAtThirdAppear:!1,showChatBubbleNoteOnMobileDevice:!1},mobileDeviceWidth:736,autoFocusOnMobileDevice:!1,chatTitleHeight:52,showConversationFeedbackAfter:3e3},evaChatHolderObject={clientId:"standard",userInput:void 0,previousUserInput:void 0,concatTimeout:void 0,feedbackComment:"",conversationFeedbackGiven:!1,checkedStar:void 0,labels:{chatBubbleNoteTitle:"Hallo! Mein Name ist EVA, ich bin Ihre digitale Assistentin...",chatTitle:"EVA - Ihre digitale Assistentin",standardPlaceholder:"Ihre Nachricht...",profanityPlaceholder:"",answerProposalPlaceholder:"Bitte wählen Sie einen der Vorschläge",chatError:"In der Kommunikation mit EVA ist ein Fehler aufgetreten.",warnings:"Es ist ein interner Fehler aufgetreten. Die nachfolgende Nachricht könnte unvollständig oder inkorrekt sein.",feedbackSuccessMsg:"Herzlichen Dank für ihr Feedback.<br>Sie helfen uns damit, EVA stetig weiter zu entwickeln.",commentPlaceholder:"Hier ist Platz für Ihren Kommentar...",convFeedbackTitle:"Bitte bewerten Sie Ihr Chaterlebnis",convFeedbackSubTitle:"Helfen Sie uns dabei unseren Service und EVA zu verbessern.",feedbackFailMsg:"Beim Speichern des Feedbacks ist ein Fehler aufgetreten.",submitConvFeedback:"Feedback senden",cancelConvFeedback:"Abbrechen"},ext_context_information:{},chatIsClicked:!1},saveContextToEVA=function(e){for(var t in e)evaChatHolderObject.ext_context_information[t]=e[t]};window.onload=function(){evaCreateChatSpeechBubble(),evaCreateChatBubble(),evaCreateChatWindow(),evaCreateChatContainer(),evaCreateChatMessages(),evaCreateAnswerProposals(),evaCreateAnimations(),evaCreateChatInput(),evaCreateAlertPopUp(),evaInit(),evaChatNoteAppearAtTimes()},setInterval(function(){evaLogger("EVA-Debug: Keep Alive every 10 Minutes."),evaKeepAliveRequest(function(){evaLogger("EVA-Debug: Keep Alive Session: Successful")},function(){evaLogger("EVA-Debug: Keep Alive Session: Failed")})},6e5);var evaInit=function(){evaLogger("EVA-Debug: init frontend variables"),evaChatHolderObject.messages=[],evaChatHolderObject.answer_proposals=void 0},evaCreateChatBubble=function(){var e=document.createElement("div"),t=document.createElement("div");t.className="fa fa-comments-o",e.id="eva_bubble_Chat",e.className="eva_bubble_Chat",e.onclick=function(){evaChatAppears()},e.appendChild(t),document.body.appendChild(e)},evaCreateChatSpeechBubble=function(){var e=document.createElement("div");e.id="eva_bubblechat_note",e.className="eva_bubble_Chat_note";var t=document.createElement("table"),a=document.createElement("tr"),n=document.createElement("td"),o=document.createElement("img");o.className="eva_img_speechbubble",o.setAttribute("src",evaFrontendConfig.paths.icon),o.setAttribute("alt","Eva"),n.appendChild(o);var i=document.createElement("td");i.innerHTML=evaChatHolderObject.labels.chatBubbleNoteTitle,a.appendChild(n),a.appendChild(i),t.appendChild(a),e.appendChild(t),e.onclick=function(){evaChatAppears()},document.body.appendChild(e)},evaChatNoteAppearAtTimes=function(){evaIsMobileDevice()&&!evaFrontendConfig.chatBubble.showChatBubbleNoteOnMobileDevice||(evaChatNoteAppear(evaFrontendConfig.chatBubble.firstAppearAfter,evaFrontendConfig.chatBubble.shakeAtFirstAppear),evaChatNoteAppear(evaFrontendConfig.chatBubble.secondAppearAfter,evaFrontendConfig.chatBubble.shakeAtSecondAppear),evaChatNoteAppear(evaFrontendConfig.chatBubble.thirdAppearAfter,evaFrontendConfig.chatBubble.shakeAtThirdAppear))},evaChatNoteAppear=function(e,t){var a=document.getElementById("eva_bubblechat_note");setTimeout(function(){!1===evaChatHolderObject.chatIsClicked&&(a.style.display="block",evaChatBubbleNoteFadeIn(a),t&&setTimeout(function(){var e=setInterval(function(){evaChatBubbleNoteShakeFunction()},700);setTimeout(function(){clearInterval(e)},2150)},1200),setTimeout(function(){evaChatBubbleNoteFadeOut(a)},evaFrontendConfig.chatBubble.appearenceTime))},e)},evaCreateChatWindow=function(){var e=document.createElement("div");e.id="eva_chatWindow",e.className="eva_chat_holder",e.style.display="none",document.body.appendChild(e);var t=document.createElement("div");t.className="eva_chat_title",t.innerHTML=evaChatHolderObject.labels.chatTitle,t.onclick=function(){evaToggleChat()};var a=document.createElement("i");a.id="eva_chatTitleSign",a.className="fa fa-angle-up eva_chatTitleSign",a.setAttribute("title","Maximieren"),t.appendChild(a),e.appendChild(t)},evaCreateChatContainer=function(){var e=document.getElementById("eva_chatWindow"),t=document.createElement("div");t.id="eva_chatDisplay",t.className="eva_chat_content",e.appendChild(t);var a=document.createElement("div");a.id="eva_chatHistory",a.className="eva_chat_history",t.appendChild(a);var n=document.createElement("div");n.id="eva_tooltipDiv",document.body.appendChild(n);var o=document.createElement("div");o.className="eva_conversation-feedback",o.id="eva_conversationFeedback",o.style.display="none",t.appendChild(o);var s=document.createElement("div");s.innerHTML=evaChatHolderObject.labels.convFeedbackTitle,s.className="eva_feedbackText",o.appendChild(s);var r=document.createElement("div");r.innerHTML=evaChatHolderObject.labels.convFeedbackSubTitle,r.className="eva_feedbackSubText",o.appendChild(r);var l=document.createElement("fieldset");for(l.className="eva_rating",o.appendChild(l),i=0;i<5;i++){var c=document.createElement("input");c.type="radio",c.id="eva_star"+i,c.name="eva_rating",c.className="eva_starInput",c.value=5-i,c.onclick=function(){u.disabled=!1,evaChatHolderObject.checkedStar=c.value},l.appendChild(c);var d=document.createElement("label");d.className="eva_full",d.title=5-i,d.htmlFor="eva_star"+i,l.appendChild(d)}var v=document.createElement("textarea");v.placeholder=evaChatHolderObject.labels.commentPlaceholder,v.id="eva_feedbackText",v.className="eva_user-feedback",v.onkeyup=function(){v.value.length?u.disabled=!1:void 0==evaChatHolderObject.checkedStar&&(u.disabled=!0)},o.appendChild(v);var u=document.createElement("button");o.appendChild(u),u.innerHTML=evaChatHolderObject.labels.submitConvFeedback,u.className="eva_feedback-button",u.id="eva_feedbackButtonSave",u.disabled=!0,u.onclick=function(){for(i=0;i<5;i++)1==document.getElementById("eva_star"+i).checked&&(evaChatHolderObject.checkedStar=document.getElementById("eva_star"+i).value);evaChatHolderObject.feedbackComment=document.getElementById("eva_feedbackText").value,o.style.display="none",evaLockInputField(0),saveConversationFeedback(function(){evaChatHolderObject.conversationFeedbackGiven=!0,t.removeChild(o),evaPopUpAlertMessage(evaChatHolderObject.labels.feedbackSuccessMsg,"success")},function(){evaPopUpAlertMessage(evaChatHolderObject.labels.feedbackFailMsg,"warning")})};var h=document.createElement("button");o.appendChild(h),h.innerHTML=evaChatHolderObject.labels.cancelConvFeedback,h.className="eva_feedback-button",h.id="eva_feedbackButtonCancel",h.onclick=function(){o.style.display="none",evaLockInputField(0)}},evaCreateChatMessages=function(){var e=document.getElementById("eva_chatHistory"),t=document.createElement("div");t.id="eva_chatMessages",e.appendChild(t)},evaCreateAnswerProposals=function(){var e=document.getElementById("eva_chatHistory"),t=document.createElement("div");t.id="eva_answerProposals",t.className="eva_answer_proposals",e.appendChild(t)},evaCreateAnimations=function(){var e=document.getElementById("eva_chatHistory"),t=document.getElementById("eva_chatDisplay"),a=document.createElement("div");e.id="eva_chatHistory",a.id="eva_chatHistoryEnd",e.appendChild(a);var n=document.createElement("div");n.id="eva_typingAnimation",n.className="eva_typing_animation",n.style.visibility="hidden",t.appendChild(n)},evaCreateChatInput=function(){var e=document.getElementById("eva_chatDisplay"),t=document.createElement("div");t.className="eva_chat_input",t.id="eva_textInputContainer";var a=document.createElement("input");a.id="eva_textInput",a.type="text",a.placeholder=evaChatHolderObject.labels.standardPlaceholder,a.tabIndex=-1,a.onkeydown=function(e){evaInputKeyDown(e)},t.appendChild(a),e.appendChild(t)},evaCreateAlertPopUp=function(){var e=document.getElementById("eva_chatDisplay"),t=document.createElement("div");t.id="eva_alert_message",t.className="eva_alert";var a=document.createElement("div");a.id="eva_blind_chat";var n=document.createElement("div");n.innerHTML="&times;",n.id="eva_alert_close",n.className="eva_alert_closebtn",n.id="eva_alert_close",n.onclick=function(){n.style.visibility="hidden",t.style.visibility="hidden",a.style.visibility="hidden"},e.insertBefore(t,e.firstChild),e.insertBefore(n,e.firstChild),e.insertBefore(a,e.firstChild)},evaPushChatMessages=function(e){var t=document.getElementById("eva_chatMessages"),a=document.createElement("div");a.className="watson"==e.user?"eva_from-watson":"eva_from-user",a.className+=" eva_message",a.id="eva_chatmessage_"+(evaChatHolderObject.messages.length-1);var n=document.createElement("p");"watson"===e.user?n.innerHTML=e.text:n.textContent=e.text,a.appendChild(n),t.appendChild(a);var o=document.createElement("hr");t.appendChild(o),"watson"==e.user&&evaShowTooltips(a)},evaPushAnswerProposals=function(e){var t=document.getElementById("eva_answerProposals"),a=[],n=evaSortProposalsBySize(e);a=evaAdjustAnswerProposalsButtonSize(n,a);for(var o=0;o<n.length;o++){var i=document.createElement("button");n.length;i.className=a[o],i.innerHTML=n[o],i.id=o,i.onclick=function(){evaLoadOrChooseAnswer(n[this.id])},t.appendChild(i)}t.style.visibility="visible"},evaResetSessionRequest=function(e,t){var a=new XMLHttpRequest;a.open("POST",evaFrontendConfig.routes.resetSessionRoute,!0),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)return 200===a.status?(evaLogger("EVA-Debug: Reset Session: Successful"),e()):(evaLogger("EVA-Debug: Reset Session: Failed"),t())},a.send()},evaKeepAliveRequest=function(e,t){var a=new XMLHttpRequest;a.open("POST",evaFrontendConfig.routes.keepAliveRoute,!0),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)return 200===a.status?(evaLogger("EVA-Debug: Keep Alive Session: Successful"),e()):(evaLogger("EVA-Debug: Keep Alive Session: Failed"),t())},a.send()},evaSendUserMessageToWatson=function(e,t,a,n,o){var i=new XMLHttpRequest;i.open("POST",evaFrontendConfig.routes.sendUserMessageRoute,!0),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status)try{return evaLogger("EVA-Debug: Get Answer from Watson: Successful"),n(JSON.parse(i.responseText))}catch(e){return evaLogger("EVA-Debug: Get Answer from Watson: Failed. Empty response."),o()}else{if(500!==i.status)return evaLogger("EVA-Debug: Get Answer from Watson: Failed. Empty response."),o();if(!i.responseText)return evaLogger("EVA-Debug: Get Answer from Watson: Failed. Empty response."),o();try{return evaLogger("EVA-Debug: Get Answer from Watson: Failed"),o(JSON.parse(i.responseText))}catch(e){return evaLogger("EVA-Debug: Get Answer from Watson: Failed. Empty response."),o()}}};var s={};s.client_id=e,t&&(s.text=t),a&&(s.ext_context_information=JSON.stringify(a)),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(s))},saveConversationFeedback=function(e,t){var a=new XMLHttpRequest;a.open("POST",evaFrontendConfig.routes.saveConversationFeedback,!0),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200===a.status)try{return evaLogger("EVA-Debug: Feedback saved successfully"),e(JSON.parse(a.responseText))}catch(e){return evaLogger("EVA-Debug: Failed to save feedback."),t()}else{if(500!==a.status)return evaLogger("EVA-Debug: Failed to save feedback."),t();if(a.responseText)try{return evaLogger("EVA-Debug: Failed to save feedback"),t(JSON.parse(a.responseText))}catch(e){return evaLogger("EVA-Debug: Failed to save feedback."),t()}}};var n={};n.client_id=evaChatHolderObject.clientId,n.comment=evaChatHolderObject.feedbackComment,n.rating=evaChatHolderObject.checkedStar,a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(n))},evaStartConversation=function(e){evaToggleTypingAnimation(!0),evaLockInputField(1),evaResetSessionRequest(function(){evaSendUserMessageToWatson(evaChatHolderObject.clientId,void 0,evaChatHolderObject.ext_context_information,function(e){evaToggleTypingAnimation(!1),evaLockInputField(0),e.lockLevel&&evaLockInputField(e.lockLevel);var t={text:e.text[0]?e.text[0]:"",user:"watson",messageId:e.messageId,topIntent:e.topIntent?e.topIntent:void 0,topConfidence:e.confidence?e.confidence.toString():void 0};evaPlotWatsonMessage(t),e.text.length<=0&&(evaPopUpAlertMessage(evaChatHolderObject.labels.warnings,"warning"),console.warn("Error while showing the welcome message. Data.text is undefined"))},function(e){evaToggleTypingAnimation(!1),evaLockInputField(0),e&&e.text?evaHandleWatsonError(e):(console.error(evaChatHolderObject.labels.chatError),evaPopUpAlertMessage(evaChatHolderObject.labels.chatError,"error")),evaPopUpAlertMessage(evaChatHolderObject.labels.chatError,"error")})},function(){evaToggleTypingAnimation(!1),evaLockInputField(0),console.error(evaChatHolderObject.labels.chatError),evaPopUpAlertMessage(evaChatHolderObject.labels.chatError,"error")})},evaConductConversation=function(e){evaToggleTypingAnimation(!0),evaLockInputField(1),evaSendUserMessageToWatson(evaChatHolderObject.clientId,e,evaChatHolderObject.ext_context_information,function(e){e.lockLevel&&evaLockInputField(e.lockLevel);var t=!1;if(-1!==e.actions.indexOf("requestConversationFeedback")&&0==evaChatHolderObject.conversationFeedbackGiven&&(evaLockInputField(1),t=!0,setTimeout(function(){try{document.getElementById("eva_conversationFeedback").style.display="inline"}catch(e){console.error(e),evaLogger("EVA-Debug: Can not set style of eva_conversationFeedback element.")}},evaFrontendConfig.showConversationFeedbackAfter)),e.text.length>0)for(var a=0,n=0,o=0;o<e.text.length;o++){(s={}).user="watson",s.text=e.text[o],s.messageId=e.messageId,s.automatedRated=e.rated?e.rated:void 0,setTimeout(function(t,a){n++,evaPlotWatsonMessage(t),n==e.text.length&&(evaToggleTypingAnimation(!1),e.lockLevel||-1!=e.answer_id.indexOf("Profanity_1")||a||evaLockInputField(0),e.answer_proposals&&e.answer_proposals.length>0&&(evaChatHolderObject.answer_proposals=e.answer_proposals,evaPushAnswerProposals(e.answer_proposals)))},a,s,t);var i=String(e.text[o]).replace(/<[^>]+>/gm,"").length*evaFrontendConfig.waitingTimePerChar;i<evaFrontendConfig.minWaitingTime&&(i=evaFrontendConfig.minWaitingTime);a=a+i}else{var s={};s.user="watson",s.text="",s.messageId=e.messageId,s.automatedRated=e.rated?e.rated:void 0,setTimeout(function(){evaPlotWatsonMessage(s),evaToggleTypingAnimation(!1),evaLockInputField(0),e.answer_proposals&&e.answer_proposals.length>0&&evaPushAnswerProposals(e.answer_proposals)},a,s)}e.warnings.length>0&&(evaPopUpAlertMessage(evaChatHolderObject.labels.warnings,"warning"),console.warn(e.warnings))},function(e){e&&e.text?evaHandleWatsonError(e):(console.error(evaChatHolderObject.labels.chatError),evaPopUpAlertMessage(evaChatHolderObject.labels.chatError,"error")),evaToggleTypingAnimation(!1),evaLockInputField(0),evaScrollToChatBottom()})},evaInputKeyDown=function(e){document.getElementById("eva_alert_message");13===e.keyCode&&(evaChatHolderObject.userInput=document.getElementById("eva_textInput").value,evaChatHolderObject.previousUserInput?evaChatHolderObject.previousUserInput+=" "+evaChatHolderObject.userInput:evaChatHolderObject.previousUserInput=evaChatHolderObject.userInput,""!=evaChatHolderObject.userInput&&evaPlotUserMessage(evaChatHolderObject.userInput)),evaChatHolderObject.concatTimeout&&clearTimeout(evaChatHolderObject.concatTimeout);var t=13===e.keyCode?evaFrontendConfig.shortConcatTimeout:evaFrontendConfig.longConcatTimeout;evaChatHolderObject.concatTimeout=setTimeout(function(){evaChatHolderObject.previousUserInput&&(document.activeElement.blur(),evaConductConversation(evaChatHolderObject.previousUserInput),evaChatHolderObject.previousUserInput=void 0,evaChatHolderObject.userInput=void 0)},t)},evaPlotWatsonMessage=function(e){evaChatHolderObject.messages.push(e),evaPushChatMessages(e),evaIsMobileDevice()&&!evaFrontendConfig.autoFocusOnMobileDevice||setTimeout(function(){document.getElementById("eva_textInput").focus()},0),evaScrollToChatBottom()},evaPlotUserMessage=function(e){document.getElementById("eva_textInput").value="";var t=document.getElementById("eva_answerProposals");if(evaChatHolderObject.answer_proposals){for(;t.firstChild;)t.removeChild(t.firstChild);evaChatHolderObject.answer_proposals=void 0}var a=document.getElementById("eva_alert_message");"eva_alert eva_alert_yellow"!==a.className&&"eva_alert eva_alert_blue"!==a.className||(a.style.visibility="hidden",document.getElementById("eva_alert_close").style.visibility="hidden");var n={text:e,user:"human"};evaChatHolderObject.messages.push(n),evaPushChatMessages(n),evaScrollToChatBottom()},evaLoadOrChooseAnswer=function(e){evaPlotUserMessage(e),evaConductConversation(e)},evaHandleWatsonError=function(e){e.err&&console.error(e.err);var t={text:e.text,user:"watson"};evaPlotWatsonMessage(t)},evaToggleChat=function(){var e=document.getElementById("eva_chatDisplay"),t=document.getElementById("eva_chatWindow"),a=document.getElementById("eva_chatHistory");-1!=e.className.indexOf("eva_chat_content_show")?(e.className=e.className.replace("eva_chat_content_show",""),t.className=t.className.replace("eva_chat_holder_move_top",""),t.className=t.className.replace("eva_chat_holder_show",""),a.className=a.className.replace("eva_chat_history_show","")):(e.className+=" eva_chat_content_show",t.className+=" eva_chat_holder_show eva_chat_holder_move_top",a.className+=" eva_chat_history_show",setTimeout(function(){evaIsMobileDevice()&&!evaFrontendConfig.autoFocusOnMobileDevice||setTimeout(function(){document.getElementById("eva_textInput").focus()},0)},1e3));var n=document.getElementById("eva_chatTitleSign");-1!=e.className.indexOf("eva_chat_content_show")?(n.className=n.className.replace("fa-angle-up",""),n.className+=" fa-angle-down",n.setAttribute("title","Minimieren")):(n.className=n.className.replace("fa-angle-down",""),n.className+=" fa-angle-up",n.setAttribute("title","Maximieren"))},evaToggleTypingAnimation=function(e){document.getElementById("eva_typingAnimation").style.visibility=e?"visible":"hidden"},evaLockInputField=function(e){evaLogger("EVA-Debug: Locklevel of Textinput set to "+e);var t=document.getElementById("eva_textInput");t.disabled=e>0,e<=1?t.placeholder=evaChatHolderObject.labels.standardPlaceholder:2==e?t.placeholder=evaChatHolderObject.labels.answerProposalPlaceholder:3==e&&(t.placeholder=evaChatHolderObject.labels.profanityPlaceholder)},evaPopUpAlertMessage=function(e,t){var a=document.getElementById("eva_alert_message"),n=document.getElementById("eva_alert_close");a.innerHTML=e,a.style.visibility="visible";var o=document.getElementById("eva_blind_chat");o.style.visibility="visible",document.getElementById("eva_alert_close").style.visibility="visible","error"==t?(a.className="eva_alert eva_alert_red",n.className="eva_alert_closebtn"):"warning"==t?(a.className="eva_alert eva_alert_yellow",n.className="eva_alert_closebtn",o.style.visibility="hidden"):"success"==t&&(a.className="eva_alert eva_alert_blue",n.className="eva_alert_closebtnblack",o.style.visibility="hidden")},evaScrollToChatBottom=function(){var e=document.getElementById("eva_chatHistory"),t=e.querySelectorAll(".eva_from-watson"),a=t[t.length-1],n=Date.now();setTimeout(function(){var t=e.scrollTop;if(e.scrollTop<a.offsetTop-10)var o=setInterval(function(){var e=document.getElementById("eva_chatHistory");Date.now()-n>=3e3?clearInterval(o):e.scrollTop<a.offsetTop-10?(t=e.scrollTop,e.scrollTop+=5,e.scrollTop!==t||clearInterval(o)):clearInterval(o)},5)},500)},evaShowTooltips=function(e){for(var t=e.querySelectorAll(".eva_tooltip"),a=document.getElementById("eva_tooltipDiv"),n=function(e){a.className="",a.style.zIndex="-1"},o=function(e,t){var n=t.getAttribute("data-tooltip");a.innerText=n;var o=a.offsetHeight+window.pageYOffset;window.parseInt(eva_helper_getAbsolutePosition(t).top,10)>o?(a.style.top=window.parseInt(eva_helper_getAbsolutePosition(t).top,10)+"px",a.className="eva_tooltip_div_after"):(a.style.top=window.parseInt(eva_helper_getAbsolutePosition(t).top+a.offsetHeight+t.offsetHeight+5,10)+"px",a.className="eva_tooltip_div_before");var i=window,s=document,e=s.documentElement,r=s.getElementsByTagName("body")[0],l=i.innerWidth||e.clientWidth||r.clientWidth,c=window.parseInt(eva_helper_getAbsolutePosition(t).left+t.offsetWidth/2,10),d=l+window.pageXOffset-a.offsetWidth/2-5;c>d&&(c=d);var v=window.pageXOffset+a.offsetWidth/2+5;c<v&&(c=v),a.style.left=c+"px",a.style.zIndex="",a.className+=" eva_tooltip_show"},i=0;i<t.length;i++){var s=t[i];s.setAttribute("data-tooltip",t[i].title),s.removeAttribute("title"),s.addEventListener("mouseover",function(e){o(e,this)}),s.addEventListener("touchstart",function(e){o(e,this),e.preventDefault()}),s.addEventListener("touchend",function(e){n(),e.preventDefault()}),s.addEventListener("mouseout",n)}},evaSortProposalsBySize=function(e){for(var t=[],a=[],n=0;n<e.length;n++)e[n].length>19?t.push(e[n]):a.push(e[n]);return t.concat(a)},evaAdjustAnswerProposalsButtonSize=function(e,t){for(var a=0,n=0,o=0;o<e.length;o++)e[o].length>19?t[o]="eva_big-button":e[o].length<5?(t[o]="eva_small-button",n++):(t[o]="eva_half-button",a++);if(n%4!=0)for(o=0;o<e.length;o++)"eva_small-button"==t[o]&&(t[o]="eva_half-button");return a%2!=0&&(t[e.length-1]="eva_big-button"),t};evaChatAppears=function(){document.getElementById("eva_chatWindow").style.display="block",evaStartConversation(),setTimeout(function(){document.getElementById("eva_bubblechat_note").style.display="none",document.getElementById("eva_bubble_Chat").style.display="none",evaToggleChat(),evaChatHolderObject.chatIsClicked=!0},500)};var evaChatBubbleNoteShakeFunction=function(){var e=setInterval(function(){evaChatBubbleNoteShakeFunctionPositions()},100);setTimeout(function(){clearInterval(e)},350)},evaChatBubbleNoteShakeFunctionPositions=function(){var e=document.getElementById("eva_bubblechat_note");setTimeout(function(){e.style.right="9.5em"},10),setTimeout(function(){e.style.right="10.3em"},20),setTimeout(function(){e.style.right="9.5em"},30),setTimeout(function(){e.style.right="10.3em"},40),setTimeout(function(){e.style.right="9.5em"},50),setTimeout(function(){e.style.right="10.3em"},60),setTimeout(function(){e.style.right="9.5em"},70),setTimeout(function(){e.style.right="10.3em"},80),setTimeout(function(){e.style.right="10em"},90)},evaChatBubbleNoteFadeIn=function(e){e.style.opacity=0;var t=0,a=setInterval(function(){t+=.1,e.style.opacity=t,e.style.opacity>=1&&clearInterval(a)},70)},evaChatBubbleNoteFadeOut=function(e){e.style.opacity=1;var t=1,a=setInterval(function(){t-=.1,e.style.opacity=t,e.style.opacity<=0&&(clearInterval(a),e.style.display="none")},70)},evaIsMobileDevice=function(){var e=window,t=document,a=t.documentElement,n=t.getElementsByTagName("body")[0];return(e.innerWidth||a.clientWidth||n.clientWidth)<=evaFrontendConfig.mobileDeviceWidth},eva_helper_getAbsolutePosition=function(e){var t={},a=document.body.getBoundingClientRect(),n=e.getBoundingClientRect();return t.top=n.top-a.top,t.left=n.left-a.left,t},evaLogger=function(e){evaFrontendConfig.loggingEnabled&&console.log(e)};
